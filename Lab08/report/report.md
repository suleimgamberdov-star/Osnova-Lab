---
## Front matter
title: "Отчёт по лабораторной работе №8"
subtitle: "Планировщики событий"
author: "Сулейм Гамбердов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков работы с планировщиками событий cron и at.

# Ход выполнения

## Планирование задач с помощью cron и at

1. Вход в систему выполнен под пользователем **sigamberdov**, затем получены права администратора с помощью команды *su*.  
   После ввода пароля успешно произведено переключение на пользователя **root**.

2. Для проверки состояния службы планировщика заданий *crond* выполнена команда *systemctl status crond -l*.  
   Из вывода видно, что служба **crond.service** находится в состоянии *active (running)*, включена в автозагрузку и работает корректно.  

   ![Проверка статуса службы crond](Screenshot_1.png){ #fig:001 width=80% }

3. Содержимое файла конфигурации **/etc/crontab** просмотрено с помощью команды *cat /etc/crontab*.  
   В файле определены переменные окружения `SHELL`, `PATH` и `MAILTO`, а также приведён пример формата задания cron.  

   ![Просмотр конфигурации /etc/crontab](Screenshot_2.png){ #fig:002 width=80% }

4. Проверен список заданий пользователя **root** с помощью *crontab -l*.  
   Так как расписание ещё не задано, выведено сообщение *no crontab for root*.

5. Для создания нового расписания выполнено редактирование с помощью *crontab -e*.  
   В файл добавлена строка:  
   `*/1 * * * * logger This message is written from root cron` 
   **Пояснение синтаксиса:**  
   - */1* — выполнение каждые 1 минуту,  
   - остальные звёздочки обозначают любое значение (часы, день, месяц, день недели),  
   - *logger* — утилита для записи сообщений в системный журнал.  

   ![Создание задания в crontab](Screenshot_3.png){ #fig:003 width=80% }

6. Повторный просмотр расписания командой *crontab -l* подтвердил наличие добавленной записи.

7. Проверка выполнения задания произведена с помощью *grep written /var/log/messages*.  
   В логе появились записи:  
   *“This message is written from root cron”*, что подтверждает корректную работу cron.  

8. После этого расписание изменено с помощью *crontab -e*.  
   В crontab добавлена строка:  
   `0 */1 * * 1-5 logger This message is written from root cron`
   **Пояснение синтаксиса:**  
   - *0* — выполнение в начале часа,  
   - */1* — каждый час,  
   - *1-5* — с понедельника по пятницу.  

   ![Изменение задания cron для рабочих дней](Screenshot_4.png){ #fig:004 width=80% }

9. Проверка содержимого crontab подтверждает, что запись обновлена корректно.

10. Выполнен переход в каталог **/etc/cron.hourly** и создан файл сценария **eachhour**.  
    В нём размещён скрипт:  
    *#!/bin/sh*  
    *logger This message is written at $(date)*  
    Скрипт записывает в системный журнал сообщение с текущей датой при каждом запуске.

    ![Создание скрипта eachhour в /etc/cron.hourly](Screenshot_5.png){ #fig:005 width=80% }

11. Файл сценария сделан исполняемым командой *chmod +x eachhour*.

12. В каталоге **/etc/cron.d** создан файл **eachhour** со следующим содержимым:  
    `11 * * * * root logger This message is written from /etc/cron.d`  
    **Пояснение синтаксиса:**  
    - *11* — выполнение на 11-й минуте каждого часа,  
    - *root* — пользователь, от имени которого выполняется команда,  
    - далее — сама команда *logger* для записи сообщения в системный журнал.  

    ![Создание файла задания eachhour в /etc/cron.d](Screenshot_6.png){ #fig:006 width=80% }

13. Через некоторое время в журнале системных сообщений с помощью *grep written /var/log/messages* подтверждено, что сообщения, созданные через **/etc/cron.d/eachhour**, успешно записываются.

## Планирование заданий с помощью at

1. Проверено состояние службы *atd*, отвечающей за выполнение одноразовых задач, командой *systemctl status atd*.  
   Из вывода видно, что служба активна (*active (running)*) и включена в автозагрузку.  

   ![Проверка службы atd](Screenshot_7.png){ #fig:007 width=80% }

2. Создано одноразовое задание на выполнение в определённое время командой *at 10:03*.  
   В интерактивном режиме введена команда *logger message from at* и завершено с помощью Ctrl+D.  
   Команда *atq* подтвердила, что задание поставлено в очередь.

3. По прошествии указанного времени выполнена проверка логов с помощью *grep 'from at' /var/log/messages*.  
   В журнале появились строки *“message from at”*, подтверждающие успешное выполнение задания.

# Контрольные вопросы

1. Чтобы настроить выполнение задания **раз в 2 недели**, можно указать запуск в определённый день недели с интервалом через неделю.  
   Например, чтобы задача выполнялась каждые две недели по понедельникам в 10:00:  
   **0 10 */14 * *** *команда***  
   Здесь */14 означает выполнение раз в 14 дней.  

2. Чтобы задание выполнялось **1-го и 15-го числа каждого месяца в 2 часа ночи**, используется запись:  
   **0 2 1,15 * *** *команда***  
   Пояснение:  
   - 0 — минуты (начало часа),  
   - 2 — час (2:00),  
   - 1,15 — дни месяца (1 и 15 числа),  
   - * — каждый месяц,  
   - * — любой день недели.  

3. Для выполнения задания **каждые 2 минуты каждый день** используется запись:  
   ***/2 * * * *** *команда***  
   Параметр */2 в поле минут означает запуск через каждые две минуты.  

4. Чтобы задание выполнялось **19 сентября ежегодно**, используется запись:  
   **0 0 19 9 *** *команда***  
   Пояснение:  
   - 0 — минут,  
   - 0 — часов (полночь),  
   - 19 — день месяца,  
   - 9 — сентябрь,  
   - * — любой день недели.  

5. Чтобы задание выполнялось **каждый четверг сентября ежегодно**, используется запись:  
   **0 0 * 9 4*** *команда***  
   Пояснение:  
   - 0 — минут,  
   - 0 — часов (полночь),  
   - * — любой день месяца,  
   - 9 — сентябрь,  
   - 4 — четверг (в формате cron воскресенье = 0, понедельник = 1, и т. д.).  

6. Чтобы назначить задание cron для пользователя **alice**, используется команда:  
   **crontab -u alice -e**  
   Пример:  
   Пользователь root может задать задание для alice, которое каждую минуту записывает сообщение в лог:  
   ***/1 * * * *** *logger "Task for alice executed"***  

7. Чтобы запретить пользователю **bob** использовать cron, нужно добавить его имя в файл **/etc/cron.deny**.  
   Пример:  
   Добавляем строку:  
   **bob**  
   После этого пользователь **bob** не сможет создавать или редактировать свои crontab-задания.  

8. Чтобы задание выполнялось даже при временной недоступности сервера, можно использовать утилиту **anacron**.  
   Она выполняет пропущенные задачи cron при следующем запуске системы.  
   Задания для anacron размещаются в каталоге **/etc/cron.daily**, **/etc/cron.weekly**, **/etc/cron.monthly** или в файле **/etc/anacrontab**.  

9. Чтобы узнать, запланированы ли какие-либо задания для выполнения планировщиком **atd**, используется команда:  
   **atq**  
   Она выводит список всех активных заданий, ожидающих выполнения.


# Заключение  

В ходе лабораторной работы были изучены основные механизмы планирования заданий в Linux с использованием утилит **cron** и **at**.  
Были рассмотрены способы создания и редактирования расписаний, настройка периодических и одноразовых задач, а также работа с каталогами **/etc/cron.\*** и конфигурационными файлами планировщика.  