---
## Front matter
title: "Отчёт по лабораторной работе №16"
subtitle: "Программный RAID"
author: "Сулейм Гамбердов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Освоить работу с RAID-массивами при помощи утилиты mdadm.

# Ход выполнения

## Проверка дисков и подготовка разделов

1. Получены права администратора с помощью команды **su -**.

2. Выполнена проверка наличия дисков `/dev/sdd`, `/dev/sde`, `/dev/sdf`.  
   Все устройства отображаются корректно.

   ![Проверка наличия дисков](Screenshot_1.png){ #fig:001 width=80% }

3. На каждом из дисков создан по одному разделу.  
   Разметка применена успешно.

   ![Создание разделов на дисках](Screenshot_2.png){ #fig:002 width=80% }

4. Проверён тип созданных разделов — он соответствует **Linux (83)**.

   ![Проверка типа разделов](Screenshot_3.png){ #fig:003 width=80% }

5. Получены доступные типы разделов, относящиеся к RAID.  
   Обнаружен тип **fd — Linux raid autodetect**.

6. Тип каждого раздела изменён на **fd**.

7. Просмотр состояния разделов показал, что все три диска имеют разделы типа **Linux raid autodetect**.

   ![Состояние разделов после изменения типа](Screenshot_4.png){ #fig:004 width=80% }

## Создание RAID-массива

8. Утилита `mdadm` доступна в системе.

9. Создан RAID-массив уровня 1 из двух дисков (`/dev/sdd1` и `/dev/sde1`).  
   Массив успешно инициализирован.

   ![Создание RAID-массива](Screenshot_5.png){ #fig:005 width=80% }

10. Просмотрено состояние RAID:  
    - уровень: RAID1  
    - устройств: 2  
    - состояние: **clean**  
    - оба диска активны (active sync)

   ![Состояние RAID-массива](Screenshot_6.png){ #fig:006 width=80% }

11. Создана файловая система **ext4** на массиве `/dev/md0`.

12. Массив подмонтирован в каталог `/mnt/raid`.

   ![Создание ФС и монтирование](Screenshot_7.png){ #fig:007 width=80% }

13. В файл `/etc/fstab` добавлена строка автомонтирования RAID-массива:

![Настройка fstab](Screenshot_8.png){ #fig:008 width=80% }

14. Сымитирован сбой диска `/dev/sde1`.

15. Сбойный диск удалён из массива.

16. В массив добавлен новый диск `/dev/sdf1`.

17. Массив восстановился успешно:  
 - активные устройства: `/dev/sdd1`, `/dev/sdf1`  
 - состояние: **clean**  
 - ошибок не выявлено

![Состояние массива после замены диска](Screenshot_9.png){ #fig:009 width=80% }

18. RAID остановлен и размонтирован.  
 Метаданные RAID очищены на всех задействованных дисках.

![Удаление массива и очистка суперблоков](Screenshot_10.png){ #fig:010 width=80% }

## RAID-массив с горячим резервом (Hot Spare)

1. Получены права администратора.

2. Создан массив RAID 1 из двух дисков `/dev/sdd1` и `/dev/sde1`.

3. Добавлен третий диск `/dev/sdf1`, который автоматически определяется как **hotspare**.

   ![Создание RAID1 и добавление hotspare](Screenshot_11.png){ #fig:011 width=80% }

4. Массив подмонтирован.

5. Проверено состояние массива:

   ![Состояние массива после добавления hotspare](Screenshot_12.png){ #fig:012 width=80% }

   **Состояние массива:**
   - уровень RAID: **raid1**
   - всего устройств: **3**
   - активных: **2**
   - hotspare: **1** (`/dev/sdf1`)
   - состояние: **clean**
   - массив корректно функционирует и готов к автоматической замене при отказе диска.

6. Имитирован сбой диска `/dev/sde1`.

7. После отказа массива hotspare автоматически замещает вышедший из строя диск.

   ![Состояние массива после отказа диска](Screenshot_13.png){ #fig:013 width=80% }

   **Пояснение:**
   - диск `/dev/sde1` получил статус **faulty**
   - диск `/dev/sdf1` автоматически переведён из hotspare в активный член массива
   - массив продолжает работать в состоянии **clean**, без ошибок

8. Массив размонтирован и остановлен, суперблоки очищены:

   ![Очистка RAID](Screenshot_14.png){ #fig:014 width=80% }

## Преобразование RAID 1 → RAID 5

1. Получены привилегии root.

2. Создан массив RAID 1 из дисков `/dev/sdd1` и `/dev/sde1`.

3. Добавлен третий диск `/dev/sdf1` (как hotspare).

   ![Создание RAID1 снова](Screenshot_15.png){ #fig:015 width=80% }

4. Массив подмонтирован.

5. Проверено состояние массива:

   ![Состояние массива до преобразования](Screenshot_16.png){ #fig:016 width=80% }

   **Состояние:**
   - RAID1
   - 2 активных диска
   - 1 hotspare
   - состояние: clean

6. Тип массива изменён на RAID 5:

   ![Grow RAID до уровня 5](Screenshot_17.png){ #fig:017 width=80% }

   **Состояние массива после изменения уровня:**
   - уровень: **raid5**
   - всего устройств: 3
   - активно 2 устройства + 1 spare
   - используется прежний размер массива

7. Увеличено количество устройств массива:

   ![Grow RAID5 на 3 диска](Screenshot_18.png){ #fig:018 width=80% }

8. Состояние RAID 5 после расширения:

   **Пояснение:**
   - RAID уровень: **raid5**
   - активные устройства: **3** (`/dev/sdd1`, `/dev/sde1`, `/dev/sdf1`)
   - объём массива увеличен до размера RAID 5 на трёх дисках  
   - состояние: **clean**
   - синхронизация успешно завершена

9. Массив размонтирован, остановлен, суперблоки очищены:

   ![Удаление массива RAID5](Screenshot_19.png){ #fig:019 width=80% }

10. В файле `/etc/fstab` запись о `/dev/md0` закомментирована.

   ![/etc/fstab](Screenshot_20.png){ #fig:020 width=80% }

# Контрольные вопросы

1. **RAID (Redundant Array of Independent Disks)** — это технология объединения нескольких физических дисков в единый логический массив с целью повышения производительности, отказоустойчивости или обоих параметров одновременно.
   Основная идея RAID заключается в распределении данных по нескольким дискам с использованием различных алгоритмов — зеркалирования, чередования блоков и вычисления контрольных сумм.

2. На сегодняшний день существуют следующие типы RAID-массивов:

   * **RAID 0** (striping, чередование данных);
   * **RAID 1** (mirroring, зеркалирование);
   * **RAID 2** (битовое чередование с использованием кодов Хэмминга);
   * **RAID 3** (байтовое чередование + выделенный диск чётности);
   * **RAID 4** (чередование блоками + выделенный диск чётности);
   * **RAID 5** (чередование блоками + распределённая чётность);
   * **RAID 6** (двойная распределённая чётность);
   * **RAID 10** (комбинация RAID 1 и RAID 0 — зеркалирование + чередование);
   * **RAID 50**, **RAID 60** и другие комбинированные уровни.

3. Характеристика основных уровней:

   * **RAID 0**

     * **Алгоритм работы:** данные разбиваются на блоки и равномерно распределяются по дискам без какой-либо избыточности.
     * **Назначение:** максимальная производительность и увеличение суммарного объёма.
     * **Недостаток:** отсутствие отказоустойчивости — отказ одного диска уничтожает весь массив.
     * **Пример применения:** временные данные, тестовые среды, высокопроизводительные вычисления без критичности потери данных.

   * **RAID 1**

     * **Алгоритм работы:** каждый блок данных записывается на два (или более) диска одновременно.
     * **Назначение:** повышение отказоустойчивости за счёт зеркалирования.
     * **Плюсы:** массив продолжает работать при отказе одного из дисков.
     * **Недостатки:** суммарный объём равен объёму одного диска.
     * **Пример применения:** серверы баз данных, системы учёта, критичные сервисы, где важна сохранность данных.

   * **RAID 5**

     * **Алгоритм работы:** данные и контрольные суммы (чётность) распределяются по всем дискам массива.
     * **Назначение:** объединение производительности и отказоустойчивости при минимальных потерях объёма.
     * **Плюсы:** допускается выход из строя одного диска.
     * **Недостаток:** снижение производительности при записи из-за расчёта чётности.
     * **Применение:** файловые серверы, корпоративные хранилища, системы резервного копирования.

   * **RAID 6**

     * **Алгоритм работы:** распределение данных и двух независимых чётностей по всем дискам.
     * **Назначение:** максимальная отказоустойчивость в линейных массивах.
     * **Плюсы:** допускается одновременный отказ двух дисков.
     * **Недостатки:** ещё более дорогая по записи схема; потеря большего объёма под чётность.
     * **Пример применения:** крупные хранилища, системы, где важна высокая надёжность и низкий риск простоя.

# Заключение

В ходе лабораторной работы были изучены принципы создания и администрирования программных RAID-массивов в Linux с использованием утилиты **mdadm**.  
Были выполнены операции по разметке дисков, созданию массивов уровней RAID 1 и RAID 5, добавлению дисков в качестве горячего резерва, симуляции отказов и последующему восстановлению работоспособности массива.  
Также выполнено преобразование RAID 1 в RAID 5 и анализ поведения массива в различных состояниях.  
