---
## Front matter
title: "Отчёт по лабораторной работе №10"
subtitle: "Основы работы с модулями ядра операционной системы"
author: "Сулейм Гамбердов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки работы с утилитами управления модулями ядра операционной системы.

# Ход выполнения

## Управление модулями ядра из командной строки

1. Для получения административных полномочий выполнена команда su. После ввода пароля произошёл переход в контекст пользователя **root**, что позволило выполнять операции с модулями ядра.  

2. Командой lspci -k получен список устройств, установленных в системе, и связанных с ними драйверов ядра.  
   В результате вывода видно, что система работает в виртуальной среде (**VirtualBox**) и использует следующие драйверы:
   - сетевой адаптер — **e1000**;  
   - видеоадаптер — **vmwgfx**;  
   - аудиоконтроллер — **snd_intel8x0**;  
   - контроллеры SATA/IDE — **ata_piix**, **ahci**;  
   - контроллер USB — **ohci-pci**;  
   - виртуальные сервисы VirtualBox — **vboxguest**.  
   Каждый блок вывода включает используемый драйвер (Kernel driver in use) и доступные модули (Kernel modules).  

   ![Вывод команды lspci -k](Screenshot_1.png){ #fig:001 width=80% }

3. Список всех загруженных в систему модулей получен с помощью команды lsmod | sort.  
   Команда сортирует результат по алфавиту, что облегчает поиск конкретных модулей. В списке присутствуют драйверы для работы с сетевыми интерфейсами, файловыми системами, устройствами хранения и виртуализации.  

   ![Список загруженных модулей ядра](Screenshot_2.png){ #fig:002 width=80% }

4. Для проверки наличия загруженного модуля ext4 выполнена команда lsmod | grep ext4. Модуль не был найден, что свидетельствует о его неактивности.  

5. Командой modprobe ext4 модуль ext4 загружен в ядро. Повторная проверка через lsmod | grep ext4 подтвердила его наличие в системе.  

6. Подробная информация о модуле получена с помощью modinfo ext4.  
   Из вывода видно:  
   - модуль расположен в каталоге /lib/modules/.../fs/ext4/;  
   - лицензия — **GPL**;  
   - описание — Fourth Extended Filesystem;  
   - авторы — Remy Card, Stephen Tweedie и другие;  
   - модуль зависит от jbd2 и mbcache;  
   - используется в ядре версии **6.12.0-55.12.1.el10_0.x86_64**.  
   Этот модуль обеспечивает поддержку файловой системы **ext4**, являющейся основной в большинстве современных Linux-дистрибутивов.  

   ![Информация о модуле ext4](Screenshot_3.png){ #fig:003 width=80% }

7. Попытка выгрузить модуль ext4 с помощью modprobe -r ext4 завершилась успешно. Однако при выгрузке модуля xfs система выдала сообщение об ошибке: *FATAL: Module xfs is in use*, указывающее на то, что данный модуль используется текущей файловой системой и не может быть удалён.  

   ![Выгрузка модулей ext4 и xfs](Screenshot_4.png){ #fig:004 width=80% }

## Загрузка модулей ядра с параметрами

1. Для работы с модулем bluetooth выполнена команда lsmod | grep bluetooth. Модуль не был найден, после чего был загружен при помощи modprobe bluetooth.  
   Повторная проверка показала наличие модуля **bluetooth**, а также зависимого модуля **rfkill**, обеспечивающего управление беспроводными интерфейсами.  

2. Команда modinfo bluetooth вывела подробные сведения о модуле:  
   - описание — Bluetooth Core ver 2.22;  
   - автор — Marcel Holtmann;  
   - версия ядра — **6.12.0-55.12.1.el10_0.x86_64**;  
   - зависит от модуля rfkill;  
   - доступные параметры:  
     - disable_esco — отключает создание eSCO-соединений;  
     - disable_ertm — отключает режим улучшенной ретрансмиссии;  
     - enable_ecred — включает расширенное управление потоком кредитов.  
   Эти параметры позволяют гибко настраивать работу Bluetooth-стека в системе.  

   ![Информация о модуле bluetooth](Screenshot_5.png){ #fig:005 width=80% }  
   ![Параметры модуля bluetooth](Screenshot_6.png){ #fig:006 width=80% }

3. После проверки модуль bluetooth был успешно выгружен командой modprobe -r bluetooth.  

## Обновление ядра системы

1. Версия используемого ядра определена командой uname -r — **6.12.0-55.12.1.el10_0.x86_64**.  

2. С помощью dnf list kernel выведен список доступных версий ядра: установлена текущая версия и доступна более новая **6.12.0-55.37.1.el10_0.x86_64**.  

   ![Список доступных версий ядра](Screenshot_7.png){ #fig:007 width=80% }

3. Для обновления системы и ядра выполнены команды:
   - dnf update kernel — проверка и установка обновлений ядра;  
   - dnf update — обновление всех пакетов системы;  
   - dnf upgrade --refresh — обновление метаданных и установка последних версий пакетов.  
   После выполнения всех операций система подтвердила отсутствие дополнительных обновлений.  

   ![Процесс обновления ядра и системы](Screenshot_8.png){ #fig:008 width=80% }

4. После перезагрузки системы команда uname -r показала, что теперь используется ядро **6.12.0-55.37.1.el10_0.x86_64**.  
   Команда hostnamectl подтвердила работу под управлением **Rocky Linux 10.0 (Red Quartz)** с виртуализацией Oracle VirtualBox и ядром новой версии.  

   ![Проверка новой версии ядра](Screenshot_9.png){ #fig:009 width=80% }

# Контрольные вопросы

1. Текущую версию ядра, используемую в системе, можно определить с помощью команды:  
   - **uname -r** — выводит номер и сборку ядра Linux.  

2. Более подробную информацию о версии и конфигурации ядра можно получить командой:  
   - **hostnamectl** — показывает версию ядра, архитектуру системы, дистрибутив и среду виртуализации.  

3. Список всех загруженных модулей ядра отображает команда:  
   - **lsmod** — выводит имена модулей, их размер и использование.  

4. Для получения информации о параметрах конкретного модуля используется команда:  
   - **modinfo имя_модуля** — отображает сведения о версии, авторе, лицензии, зависимостях и параметрах модуля.  

5. Выгрузить модуль ядра можно командой:  
   - **modprobe -r имя_модуля** — безопасно удаляет модуль из памяти, если он не используется другими компонентами.  

6. Если при попытке выгрузить модуль ядра появляется сообщение об ошибке, например *"Module is in use"*, это означает, что модуль используется системой или зависимыми компонентами.  
   В этом случае необходимо:  
   - убедиться, что устройства, связанные с модулем, не активны;  
   - остановить службы, использующие данный модуль;  
   - при необходимости выполнить выгрузку после перезагрузки системы.  

7. Поддерживаемые параметры модуля можно определить через команду:  
   - **modinfo имя_модуля** — в конце вывода отображаются доступные параметры (*parm*), их описание и тип данных.  

8. Новая версия ядра устанавливается с помощью пакетного менеджера DNF:  
   - **dnf update kernel** — обновляет пакет ядра до последней доступной версии;  
   - **dnf upgrade --refresh** — обновляет все пакеты системы и ядро до актуального состояния.  
   После установки необходимо перезагрузить систему и выбрать новое ядро при запуске.

# Заключение  

В ходе выполнения лабораторной работы были изучены основы управления модулями ядра операционной системы Linux.  
Были рассмотрены команды для просмотра списка устройств и драйверов (lspci), анализа загруженных модулей (lsmod), получения информации о них (modinfo), а также их загрузки и выгрузки (modprobe), была проведена практическая работа по обновлению версии ядра средствами пакетного менеджера DNF.  
