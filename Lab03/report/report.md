---
## Front matter
title: "Отчёт по лабораторной работе №3"
subtitle: "Настройка прав доступа"
author: "Сулейм Гамбердов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков настройки базовых и специальных прав доступа для групп пользователей в операционной системе типа Linux.

# Ход выполнения

## Управление базовыми разрешениями

1. Открыт терминал и выполнен переход под суперпользователя командой *su*.  
   После ввода пароля активирована учётная запись **root**, что подтверждается приглашением командной строки.  

2. В корневом каталоге созданы подкаталоги **/data/main** и **/data/third**.  
   Проверка содержимого каталога *data* с помощью *ls -Al /data* показала, что владельцем каталогов является **root**.  

   ![Создание каталогов и проверка владельцев](Screenshot_1.png){ #fig:001 width=80% }

3. Выполнено изменение групп-владельцев каталогов: **/data/main** передан группе **main**, а **/data/third** — группе **third**.  
   Повторная проверка вывода *ls -Al /data* подтвердила изменения: теперь каталог **/data/main** принадлежит группе **main**, а каталог **/data/third** — группе **third**.  

4. Для каталогов установлены права доступа **770**.  
   Это означает:  
   - владелец и группа имеют полный доступ (*rwx*),  
   - остальные пользователи не имеют прав доступа (*---*).  

5. В другом терминале выполнено переключение на пользователя **bob**.  

6. Пользователь **bob** смог перейти в каталог **/data/main** и создать в нём файл *emptyfile*.  
   В выводе *ls -Al* видно, что созданный файл принадлежит пользователю **bob**.  
   Это стало возможным, так как группа каталога **main** имеет права на запись, и пользователь **bob** состоит в этой группе.  

7. При попытке перейти в каталог **/data/third** и создать файл, система вернула сообщение *Permission denied*.  
   Доступ запрещён, так как пользователь **bob** не входит в группу **third**, а для остальных пользователей доступ полностью закрыт.  

## Управление специальными разрешениями

1. Выполнен вход под пользователем **alice** и выполнен переход в каталог **/data/main**.  
   В этом каталоге созданы два файла — *alice1* и *alice2*, владельцем которых является пользователь **alice**.  

2. В другом терминале произведено переключение на пользователя **bob**, который также входит в группу **main**.  
   После перехода в каталог **/data/main** команда *ls -l* показала наличие файлов, созданных пользователем **alice**.  
   При попытке удалить эти файлы с помощью *rm -f alice** операция прошла успешно — файлы были удалены, хотя их владельцем был другой пользователь. Это возможно, так как в каталоге ещё не был установлен *sticky bit*, а права группы позволяли удаление.  

3. Под пользователем **bob** в каталоге **/data/main** созданы два файла — *bob1* и *bob2*.  
   Они принадлежат пользователю **bob** и группе **bob**.  

4. Для каталога **/data/main** под пользователем **root** установлен бит идентификатора группы (*setgid*) и *sticky bit*.  
   Команда *chmod g+s,o+t /data/main* обеспечила:  
   - автоматическое наследование групповой принадлежности для новых файлов;  
   - запрет на удаление файлов другими пользователями, даже если у них есть права на запись в каталог.  

5. После этого пользователь **alice** снова создал два файла — *alice3* и *alice4*.  
   Проверка содержимого каталога показала, что новые файлы принадлежат группе **main**, то есть унаследовали групповую принадлежность каталога.  

6. Попытка удалить файлы, созданные пользователем **bob** (*rm -rf bob**), завершилась неудачей.  
   Система вернула сообщение *Operation not permitted*, так как был установлен *sticky bit*. Это подтверждает, что теперь удалить файлы в общем каталоге может только их владелец или администратор.  

   ![Создание и попытка удаления файлов с sticky bit](Screenshot_2.png){ #fig:002 width=80% }


## Управление расширенными разрешениями с использованием ACL

1. Выполнен вход под пользователем **root**.  

2. Для группы **third** установлены права чтения и выполнения в каталоге **/data/main**, а для группы **main** — права чтения и выполнения в каталоге **/data/third**.  
   Проверка через *getfacl* подтвердила назначение:  
   - каталог **/data/main** теперь доступен группе **third** с правами `r-x`;  
   - каталог **/data/third** доступен группе **main** с правами `r-x`.  

   ![Назначение ACL и проверка](Screenshot_3.png){ #fig:003 width=80% }

3. Создан новый файл *newfile1* в каталоге **/data/main**.  
   При проверке через *getfacl* видно, что файл имеет стандартные права: владелец **root** — `rw-`, группа — `r--`, остальные — `r--`.  
   Права группы **third** для этого файла отсутствуют, так как ACL были назначены только каталогу, но не распространяются на уже созданные файлы.  

   Аналогично, в каталоге **/data/third** создан файл *newfile1*. Он также получил стандартные права, без учёта ACL для группы **main**.  

   ![Создание файлов и проверка ACL](Screenshot_4.png){ #fig:004 width=80% }

4. Для корректного наследования прав были установлены ACL по умолчанию:  
   - для каталога **/data/main** — `d:g:third:rwx`;  
   - для каталога **/data/third** — `d:g:main:rwx`.  

   После этого созданы новые файлы *newfile2* в каждом каталоге. Проверка показала, что они унаследовали права ACL по умолчанию:  
   - в каталоге **/data/main** файлы имеют права для группы **third**;  
   - в каталоге **/data/third** — для группы **main**.  

   ![ACL по умолчанию и проверка наследования](Screenshot_5.png){ #fig:005 width=80% }

5. Для проверки полномочий был выполнен вход под пользователем **carol**, который входит в группу **third**.  
   Попытка удалить файлы *newfile1* и *newfile2* в каталоге **/data/main** завершилась ошибкой *Permission denied*.  
   Аналогично, при попытке записать данные в эти файлы также возник отказ.  

   Это объясняется тем, что группа **third** получила права на чтение и выполнение, а также наследование прав на новые файлы, но не имеет полномочий на удаление или запись в файлы, владельцем которых является другой пользователь.  

   ![Проверка полномочий пользователя carol](Screenshot_6.png){ #fig:006 width=80% }


# Контрольные вопросы

1. Как следует использовать команду chown, чтобы установить владельца группы для файла? Приведите пример.  
   - Для изменения владельца группы используется команда **chown** в формате:  
     `chown :имя_группы файл`  
   - Пример:  
     `chown :developers project.txt`  
     Файл *project.txt* будет принадлежать группе **developers**.  

2. С помощью какой команды можно найти все файлы, принадлежащие конкретному пользователю? Приведите пример.  
   - Используется команда **find**:  
     `find / -user alice`  
     Найдёт все файлы, владельцем которых является пользователь **alice**.  

3. Как применить разрешения на чтение, запись и выполнение для всех файлов в каталоге /data для пользователей и владельцев групп, не устанавливая никаких прав для других? Приведите пример.  
   - Используется команда **chmod**:  
     `chmod -R 770 /data`  
     Пользователь и группа получают права *rwx*, а остальные не имеют доступа.  

4. Какая команда позволяет добавить разрешение на выполнение для файла, который необходимо сделать исполняемым?  
   - Применяется команда:  
     `chmod +x script.sh`  
     Теперь файл *script.sh* станет исполняемым.  

5. Какая команда позволяет убедиться, что групповые разрешения для всех новых файлов, создаваемых в каталоге, будут присвоены владельцу группы этого каталога? Приведите пример.  
   - Для этого используется **setgid** на каталог:  
     `chmod g+s /data/projects`  
     Все новые файлы в каталоге **/data/projects** будут принадлежать его группе.  

6. Необходимо, чтобы пользователи могли удалять только те файлы, владельцами которых они являются, или которые находятся в каталоге, владельцами которого они являются. С помощью какой команды можно это сделать? Приведите пример.  
   - Для этого используется **sticky bit**:  
     `chmod +t /shared`  
     В каталоге **/shared** пользователи смогут удалять только свои файлы.  

7. Какая команда добавляет ACL, который предоставляет членам группы права доступа на чтение для всех существующих файлов в текущем каталоге?  
   - Используется команда:  
     `setfacl -m g:developers:r *`  
     Все файлы в текущем каталоге становятся доступными группе **developers** для чтения.  

8. Что нужно сделать для гарантии того, что члены группы получат разрешения на чтение для всех файлов в текущем каталоге и во всех его подкаталогах, а также для всех файлов, которые будут созданы в этом каталоге в будущем? Приведите пример.  
   - Нужно применить **ACL по умолчанию**:  
     `setfacl -R -m g:developers:rx /data`  
     `setfacl -d -m g:developers:rx /data`  
     Теперь группа **developers** получит права чтения и выполнения для всех файлов и каталогов, включая новые.  

9. Какое значение umask нужно установить, чтобы «другие» пользователи не получали какие-либо разрешения на новые файлы? Приведите пример.  
   - Для этого значение **umask** должно быть `0077`.  
   - Пример:  
     `umask 077`  
     Новые файлы будут доступны только владельцу и его группе.  

10. Какая команда гарантирует, что никто не сможет удалить файл myfile случайно?  
   - Для защиты файла от удаления можно убрать права на запись каталога или назначить атрибут **immutable**:  
     `chattr +i myfile`  
     Теперь файл *myfile* нельзя будет удалить или изменить, пока атрибут не будет снят.  

# Заключение  

В ходе работы были рассмотрены базовые и специальные разрешения, а также расширенные механизмы управления доступом с помощью ACL.  
Это позволило закрепить навыки администрирования прав в Linux и понять, как обеспечивать безопасный совместный доступ пользователей к общим ресурсам.  
