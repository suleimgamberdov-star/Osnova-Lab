---
## Front matter
title: "Отчёт по лабораторной работе №14"
subtitle: "Партиции, файловые системы, монтирование"
author: "Сулейм Гамбердов"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получить навыки создания разделов на диске и файловых систем. Получить навыки монтирования файловых систем.

# Ход выполнения

## Создание разделов MBR на диске /dev/sdb с использованием fdisk

1. После получения административных прав выполнен просмотр списка доступных устройств. В выводе присутствуют дополнительные диски `/dev/sdb` и `/dev/sdc`, каждый объёмом 1.5 GiB.

   ![Просмотр списка дисков через fdisk -l](Screenshot_1.png){ #fig:001 width=80% }

2. Для разметки диска запущена утилита `fdisk /dev/sdb`. После запуска была выведена справочная информация по командам с помощью клавиши **m**.

   ![Справка по командам fdisk](Screenshot_2.png){ #fig:002 width=80% }

3. Перед внесением изменений проверено текущее состояние таблицы разделов с помощью команды **p**.

4. Создан новый основной раздел объёмом **300 MiB**.  
   Выбран тип раздела *primary*, номер оставлен по умолчанию, первый сектор — по умолчанию, размер задан как `+300M`.

   ![Создание основного раздела 300 MiB](Screenshot_3.png){ #fig:003 width=80% }

5. Изменения записаны на диск командой **w**. Далее проверено актуальное состояние таблицы разделов и содержимое `/proc/partitions`.

   ![Проверка добавленного раздела через fdisk и вывод /proc/partitions](Screenshot_4.png){ #fig:004 width=80% }

6. Разница между выводом `fdisk -l` и содержимым `/proc/partitions` заключается в том, что первый показывает считанную с диска таблицу разделов, а второй — данные, загруженные ядром. Ядро не обновляет таблицу разделов автоматически, пока не выполнена синхронизация.

7. Для обновления таблицы разделов ядра использована команда `partprobe /dev/sdb`.

## Создание расширенного и логического разделов

1. Повторно открыт инструмент разметки для устройства `/dev/sdb`.

2. Создан расширенный раздел размером **1.2 GiB**, который занимает всё оставшееся пространство.  

   ![Создание расширенного раздела](Screenshot_5.png){ #fig:005 width=80% }

3. Внутри расширенного раздела добавлен логический раздел №5 размером **300 MiB**.

4. Изменения записаны и таблица разделов ядра обновлена. После этого просмотрен список доступных разделов.

   ![Проверка логического раздела](Screenshot_6.png){ #fig:006 width=80% }

## Создание раздела подкачки (swap)

1. Вновь открыт fdisk для устройства `/dev/sdb`.

2. Создан логический раздел №6 размером **300 MiB**.

3. Тип созданного раздела изменён на **82 (Linux swap)**.

4. Изменения записаны и таблица разделов обновлена.

   ![Создание раздела подкачки](Screenshot_7.png){ #fig:007 width=80% }

5. После проверки структуры диска раздел подкачки был отформатирован и активирован. 

6. Проверка состояния памяти показала, что новый swap подключён и используется системой.

   ![Активация swap и проверка free -m](Screenshot_8.png){ #fig:008 width=80% }

## Создание разделов GPT с использованием gdisk

1. После получения административных прав просмотрена таблица разделов на устройстве `/dev/sdc` с помощью команды `gdisk -l /dev/sdc`.  
   Вывод показал отсутствие существующей таблицы разделов и предложил создать новую GPT.

   ![Просмотр таблицы разделов gdisk -l](Screenshot_9.png){ #fig:009 width=80% }

2. Запущена утилита `gdisk /dev/sdc`, которая автоматически создала новую GPT-разметку в памяти.

3. Создан новый раздел с помощью команды **n**.  
   Принят номер раздела по умолчанию, выбран первый доступный сектор.  
   Размер задан как `+300M`.

   ![Создание нового GPT-раздела](Screenshot_10.png){ #fig:010 width=80% }

4. Тип раздела оставлен по умолчанию — `8300 (Linux filesystem)`.

5. Командой **p** просмотрена текущая разметка, после чего изменения записаны командой **w**.

6. После записи таблицы разделов повторно выведена её структура с помощью `gdisk -l /dev/sdc`.

   ![Просмотр записанной GPT-разметки](Screenshot_11.png){ #fig:011 width=80% }

## Форматирование файловой системы 

1. Создана файловая система XFS на разделе `/dev/sdb1` командой `mkfs.xfs`.

2. Установлена метка файловой системы **xfsdisk** с помощью `xfs_admin -L xfsdisk /dev/sdb1`.

   ![Форматирование XFS и установка метки](Screenshot_12.png){ #fig:012 width=80% }

3. Создана файловая система EXT4 на разделе `/dev/sdb5`.

4. Установлена метка файловой системы **ext4disk** с помощью `tune2fs -L ext4disk /dev/sdb5`.

5. Попытка установки параметров монтирования по умолчанию `acl,user_xattr` привела к ошибке, так как используемая система монтирования не поддерживает их в таких настройках.

## Ручное монтирование EXT4-раздела

1. Создана точка монтирования `/mnt/tmp`.

2. Раздел `/dev/sdb5` смонтирован в указанную директорию.  
   Проверка `mount` подтвердила успешное подключение.

3. После проверки раздел был отмонтирован и снова проверен выводом `mount`.

   ![Ручное монтирование и размонтирование EXT4](Screenshot_13.png){ #fig:013 width=80% }

## Монтирование XFS через /etc/fstab

1. Создана точка монтирования для XFS-раздела:

   `/mnt/data`

2. С помощью `blkid` получены UUID всех устройств, включая `/dev/sdb1`.

   ![Вывод blkid и поиск UUID](Screenshot_14.png){ #fig:014 width=80% }

3. Открыт файл `/etc/fstab`, в который добавлена строка для автоматического монтирования раздела:

![Редактирование /etc/fstab](Screenshot_15.png){ #fig:015 width=80% }

4. Выполнена проверка конфигурации с помощью `mount -a`.

5. Команда `df -h` подтвердила успешное монтирование раздела `/dev/sdb1` в `/mnt/data`.

![Монтирование](Screenshot_16.png){ #fig:016 width=80% }

## Самостоятельная работа

1. На диске `/dev/sdc` была обнаружена существующая GPT-разметка. После запуска `gdisk /dev/sdc` добавлены два новых раздела.

2. Создан второй раздел размером **100 MiB**.  
   Раздел получил тип **Linux filesystem (8300)**.

   ![Создание раздела ext4 на GPT](Screenshot_17.png){ #fig:017 width=80% }

3. Создан третий раздел также размером **100 MiB**, но его тип был изменён на **8200 (Linux swap)**.

4. После проверки таблицы разделов изменения были записаны командой `w`.

5. Раздел `/dev/sdc2` отформатирован в файловую систему **ext4**.  

   Выполнено назначение метки `ext4disk`.

6. Раздел `/dev/sdc3` подготовлен как пространство подкачки с помощью `mkswap`.

   ![Форматирование ext4 и создание swap](Screenshot_18.png){ #fig:018 width=80% }

7. Получены UUID всех файловых систем через `blkid`.

8. В файл `/etc/fstab` добавлены строки:

   - для ext4-раздела: монтирование в `/mnt/data-ext`
   - для swap-раздела: автоматическое подключение при загрузке

   ![Редактирование fstab с добавлением ext4 и swap](Screenshot_19.png){ #fig:019 width=80% }

9. Команда `mount | grep mnt` подтвердила автоматическое подключение ext4-раздела в `/mnt/data-ext`.

10. Команда `df -h` показала корректное отображение файловой системы.

11. Команда `free -m` подтвердила, что система использует новый раздел подкачки.

   ![Проверка монтирования, df -h и swap после перезагрузки](Screenshot_20.png){ #fig:020 width=80% }

# Контрольные вопросы

1. Для создания разделов с использованием GUID-таблицы (GPT) применяется утилита **gdisk**.  
   Она позволяет создавать, изменять и просматривать разделы в формате GPT.

2. Для работы с таблицей разделов MBR используется инструмент **fdisk**.  
   Утилита предназначена для создания, удаления и управления разделами в формате MBR.

3. Автоматическое монтирование разделов при загрузке выполняется на основе конфигурации, хранящейся в файле **/etc/fstab**.  
   В этом файле указываются UUID устройств, точки монтирования, типы файловых систем и параметры монтирования.

4. Чтобы файловая система **не монтировалась автоматически** при загрузке, используют параметр **noauto** в строке монтирования в `/etc/fstab`.  
   При этом раздел можно подключать вручную при необходимости.

5. Форматирование раздела с типом **82 (Linux swap)** выполняется командой **mkswap /dev/имя_раздела**.  
   После этого раздел можно активировать командой **swapon**.

6. Проверить работоспособность конфигурации `/etc/fstab` без перезагрузки можно с помощью команды:  
   **mount -a**  
   Она пытается смонтировать все разделы, указанные в файле, позволяя убедиться в корректности настроек.

7. Если выполнить команду **mkfs** без указания типа файловой системы, будет использована файловая система **EXT2** по умолчанию (для большинства дистрибутивов).  

8. Форматирование раздела EXT4 выполняется командой:  
   **mkfs.ext4 /dev/имя_раздела**  
   При необходимости можно дополнительно указать метку с помощью **tune2fs -L**.

9. Для получения UUID всех устройств используется команда **blkid**.  
   Она отображает UUID, тип файловой системы и метки всех блочных устройств.

# Заключение

В ходе выполнения работы были изучены основные инструменты разметки и управления дисковым пространством в Linux. Были созданы разделы с разбиением GPT и MBR, выполнено форматирование в файловые системы XFS и EXT4, а также настроены области подкачки. Освоены методы ручного монтирования и автоматической загрузки разделов через файл `/etc/fstab`. Полученные навыки позволяют уверенно управлять дисковой подсистемой, обеспечивая корректную организацию хранения данных и оптимальное функционирование операционной системы.
